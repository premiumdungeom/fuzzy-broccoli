<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdHive</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --primary-blue: #007BFF;
            --secondary-blue: #0056b3;
            --background: #ffffff;
            --text: #000000;
            --light-gray: #f5f5f5;
            --border-radius: 10px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        body {
            background-color: var(--background);
            color: var(--text);
            max-width: 100%;
            overflow-x: hidden;
        }
        
        .container {
            padding: 16px;
            max-width: 100%;
            margin: 0 auto;
        }
        
        .centered {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .btn {
            background-color: var(--primary-blue);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            padding: 12px 20px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            text-decoration: none;
            display: inline-block;
            margin: 8px 0;
            width: 100%;
            max-width: 300px;
        }
        
        .btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .btn:hover:not(:disabled) {
            background-color: var(--secondary-blue);
        }
        
        .card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 16px;
            margin-bottom: 16px;
            width: 100%;
        }
        
        .blue-box {
            background-color: var(--primary-blue);
            color: white;
            border-radius: var(--border-radius);
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background-color: var(--primary-blue);
            color: white;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
        }
        
        .balance-section {
            text-align: center;
            padding: 20px 0;
        }
        
        .balance-amount {
            font-size: 48px;
            font-weight: bold;
            margin: 8px 0;
        }
        
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 20px 0;
        }
        
        .action-btn {
            background-color: var(--primary-blue);
            color: white;
            border-radius: var(--border-radius);
            padding: 16px;
            text-align: center;
            font-weight: 500;
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-around;
            background-color: white;
            padding: 12px 0;
            border-top: 1px solid #eee;
            z-index: 100;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 12px;
            color: #888;
        }
        
        .nav-item.active {
            color: var(--primary-blue);
        }
        
        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }
        
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-blue);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        
        .rank-circle {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 12px;
            font-weight: bold;
        }
        
        .rank-1 {
            background-color: gold;
            color: black;
        }
        
        .rank-2 {
            background-color: silver;
            color: black;
        }
        
        .rank-3 {
            background-color: #cd7f32; /* Bronze */
            color: white;
        }
        
        .rank-other {
            background-color: white;
            color: black;
            border: 1px solid #eee;
        }
        
        .user-details {
            flex-grow: 1;
        }
        
        .points {
            color: var(--primary-blue);
            font-weight: bold;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 16px;
        }
        
        .page {
            display: none;
            padding-bottom: 60px; /* Space for bottom nav */
        }
        
        .page.active {
            display: block;
        }
        
        .channel-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        
        .admin-panel {
            background-color: var(--light-gray);
            padding: 16px;
            border-radius: var(--border-radius);
            margin-top: 16px;
        }
        
        .admin-section {
            margin-bottom: 24px;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="container centered" style="height: 100vh;">
        <div class="loader"></div>
        <p>Loading Home Page…</p>
    </div>

    <!-- Join Channels Page -->
    <div id="join-channels-page" class="page container">
        <h2 style="text-align: center; margin: 20px 0;">Join Our Channels</h2>
        
        <div class="card">
            <div class="channel-item">
                <div>
                    <h3>All In One Payout</h3>
                    <p>@allinonepayout</p>
                </div>
                <button id="join-channel-1" class="btn">Join</button>
            </div>
            
            <div class="channel-item">
                <div>
                    <h3>ALL1N_0NE</h3>
                    <p>@ALL1N_0NE</p>
                </div>
                <button id="join-channel-2" class="btn">Join</button>
            </div>
        </div>
        
        <div style="margin-top: 20px;">
            <button id="verify-join" class="btn">Joined</button>
        </div>
        
        <div id="join-error" style="color: red; text-align: center; margin-top: 10px; display: none;">
            Join all channels to continue
        </div>
    </div>

    <!-- Welcome Back Message -->
    <div id="welcome-back-message" class="container centered" style="height: 100vh; display: none;">
        <h2>Welcome back</h2>
    </div>

    <!-- Main Menu Page -->
    <div id="main-menu-page" class="page">
        <div class="header">
            <div>AdHive</div>
            <div class="user-info">
                <img id="user-avatar" class="user-avatar" src="" alt="Profile">
                <div>
                    <div id="user-fullname"></div>
                    <div id="user-username"></div>
                </div>
            </div>
        </div>
        
        <div class="container">
            <div class="blue-box balance-section">
                <div>Total Balance</div>
                <div id="balance-amount" class="balance-amount">0</div>
                <div id="friends-count">0 friends invited • Rank #0</div>
                <div id="conversion-rate">Conversion rate: 1 point = 20 Ton</div>
            </div>
            
            <div class="quick-actions">
                <div class="action-btn" data-page="withdraw-page">Withdraw</div>
                <div class="action-btn" data-page="advertise-page">Advertise</div>
                <div class="action-btn" data-page="wallet-page">Wallet</div>
                <div class="action-btn" data-page="history-page">History</div>
            </div>
            
            <!-- Leaderboard Section -->
            <h3 style="margin: 20px 0 10px;">AdHive Leaderboard Rank</h3>
            <div id="leaderboard-loading">
                <div class="loader"></div>
                <p style="text-align: center;">Loading leaderboard...</p>
            </div>
            <div id="leaderboard-content" style="display: none;">
                <!-- Leaderboard items will be populated by JavaScript -->
            </div>
        </div>
        
        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-item active" data-page="main-menu-page">
                <div class="nav-icon">🏠</div>
                <div>Home</div>
            </div>
            <div class="nav-item" data-page="tasks-page">
                <div class="nav-icon">📑</div>
                <div>Tasks</div>
            </div>
            <div class="nav-item" data-page="ads-page">
                <div class="nav-icon">🔈</div>
                <div>Ads</div>
            </div>
            <div class="nav-item" data-page="profile-page">
                <div class="nav-icon" style="color: var(--primary-blue);">🍏</div>
                <div>Profile</div>
            </div>
        </div>
    </div>

    <!-- Withdraw Page -->
    <div id="withdraw-page" class="page container">
        <h2 style="margin: 20px 0;">Withdraw</h2>
        
        <div class="card">
            <div class="form-group">
                <label class="form-label">Available Points</label>
                <div id="available-points" style="font-size: 18px; font-weight: bold;">572</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Amount to Withdraw</label>
                <input type="number" class="form-input" id="withdraw-amount" placeholder="Enter points">
            </div>
            
            <div class="form-group">
                <label class="form-label">Amount to be Received</label>
                <div id="received-amount" style="font-size: 18px; font-weight: bold;">0.00 Ton</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Bank Account</label>
                <div style="padding: 12px; background-color: var(--light-gray); border-radius: var(--border-radius);">
                    No bank details added
                </div>
            </div>
            
            <button id="place-withdrawal" class="btn">Place Withdrawal</button>
            
            <div style="margin-top: 16px; font-size: 14px; color: #666;">
                <p>Minimum withdrawal: 1,000 points</p>
                <p>Processing time: 24–48 hours</p>
            </div>
        </div>
    </div>

    <!-- Profile Page -->
    <div id="profile-page" class="page container">
        <h2 style="margin: 20px 0;">Profile</h2>
        
        <div class="card">
            <div style="display: flex; align-items: center; margin-bottom: 20px;">
                <img id="profile-avatar" class="user-avatar" src="" alt="Profile" style="width: 64px; height: 64px;">
                <div style="margin-left: 16px;">
                    <div id="profile-fullname" style="font-weight: bold;"></div>
                    <div id="profile-username"></div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Invite Code</label>
                <div style="display: flex;">
                    <input type="text" class="form-input" id="invite-code" value="AHIVE12345" readonly>
                    <button style="margin-left: 8px; white-space: nowrap;" class="btn" onclick="copyInviteCode()">Copy</button>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Friends Invited</label>
                <div id="profile-friends-count" style="font-size: 18px;">0</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Total Points Earned</label>
                <div id="total-points" style="font-size: 18px;">0</div>
            </div>
            
            <div id="admin-panel-section" style="display: none;">
                <h3 style="margin: 30px 0 15px;">Admin Panel</h3>
                <div class="admin-panel">
                    <div class="admin-section">
                        <h4>Conversion Rate</h4>
                        <div style="display: flex;">
                            <input type="number" class="form-input" id="conversion-rate-input" value="20">
                            <select class="form-input" id="currency-select" style="margin-left: 8px; width: 100px;">
                                <option>Ton</option>
                                <option>BTC</option>
                                <option>USDT</option>
                            </select>
                        </div>
                        <button class="btn" style="margin-top: 10px;" onclick="updateConversionRate()">Update Rate</button>
                    </div>
                    
                    <div class="admin-section">
                        <h4>Minimum Withdrawal</h4>
                        <input type="number" class="form-input" id="min-withdrawal" value="1000">
                        <button class="btn" style="margin-top: 10px;" onclick="updateMinWithdrawal()">Update Minimum</button>
                    </div>
                    
                    <div class="admin-section">
                        <h4>Mini App Code</h4>
                        <button class="btn" onclick="showMiniAppCode()">Get Mini App Code</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Other pages placeholder -->
    <div id="tasks-page" class="page container">
        <h2 style="margin: 20px 0;">Tasks</h2>
        <div class="card">
            <p style="text-align: center; padding: 20px;">No tasks available at the moment</p>
        </div>
    </div>

    <div id="ads-page" class="page container">
        <h2 style="margin: 20px 0;">Ads</h2>
        <div class="card">
            <p style="text-align: center; padding: 20px;">No ads available at the moment</p>
        </div>
    </div>

    <div id="wallet-page" class="page container">
        <h2 style="margin: 20px 0;">Wallet</h2>
        <div class="card">
            <p style="text-align: center; padding: 20px;">Wallet functionality coming soon</p>
        </div>
    </div>

    <div id="history-page" class="page container">
        <h2 style="margin: 20px 0;">History</h2>
        <div class="card">
            <p style="text-align: center; padding: 20px;">No history available</p>
        </div>
    </div>

    <script>
        // Telegram Web App initialization
        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();
        
        // Global variables
        let userData = null;
        let isAdmin = false;
        const adminId = 5650788149;
        const channels = [
            { id: 1, name: "All In One Payout", username: "allinonepayout", url: "https://t.me/allinonepayout" },
            { id: 2, name: "ALL1N_0NE", username: "ALL1N_0NE", url: "https://t.me/ALL1N_0NE" }
        ];
        let joinedChannels = {};
        let conversionRate = 20;
        let currency = "Ton";
        let minWithdrawal = 1000;
        
        // Initialize the app
        function init() {
            // Check if user is coming from Telegram
            if (!tg.initDataUnsafe.user) {
                document.body.innerHTML = '<div class="container centered" style="height: 100vh;"><h2>Please open this app from Telegram</h2></div>';
                return;
            }
            
            // Get user data from Telegram
            userData = tg.initDataUnsafe.user;
            isAdmin = userData.id === adminId;
            
            // Check if user has already joined channels
            const hasJoined = localStorage.getItem('adhive_joined');
            
            if (hasJoined) {
                showWelcomeBack();
            } else {
                showJoinChannels();
            }
            
            // Set up user info
            if (userData.photo_url) {
                document.getElementById('user-avatar').src = userData.photo_url;
                document.getElementById('profile-avatar').src = userData.photo_url;
            }
            
            document.getElementById('user-fullname').textContent = `${userData.first_name} ${userData.last_name || ''}`;
            document.getElementById('user-username').textContent = `@${userData.username}`;
            
            document.getElementById('profile-fullname').textContent = `${userData.first_name} ${userData.last_name || ''}`;
            document.getElementById('profile-username').textContent = `@${userData.username}`;
            
            // Show admin panel if user is admin
            if (isAdmin) {
                document.getElementById('admin-panel-section').style.display = 'block';
            }
            
            // Set up event listeners
            setupEventListeners();
            
            // Load leaderboard after a delay
            setTimeout(loadLeaderboard, 2000);
        }
        
        // Set up event listeners
        function setupEventListeners() {
            // Channel join buttons
            document.getElementById('join-channel-1').addEventListener('click', () => {
                window.open(channels[0].url, '_blank');
                joinedChannels[channels[0].id] = true;
                updateJoinButtons();
            });
            
            document.getElementById('join-channel-2').addEventListener('click', () => {
                window.open(channels[1].url, '_blank');
                joinedChannels[channels[1].id] = true;
                updateJoinButtons();
            });
            
            // Verify join button
            document.getElementById('verify-join').addEventListener('click', verifyChannelsJoin);
            
            // Navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    const pageId = item.getAttribute('data-page');
                    showPage(pageId);
                    
                    // Update active nav item
                    document.querySelectorAll('.nav-item').forEach(navItem => {
                        navItem.classList.remove('active');
                    });
                    item.classList.add('active');
                });
            });
            
            // Quick actions
            document.querySelectorAll('.action-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const pageId = btn.getAttribute('data-page');
                    showPage(pageId);
                });
            });
            
            // Withdraw amount calculation
            document.getElementById('withdraw-amount').addEventListener('input', calculateWithdrawal);
        }
        
        // Show join channels page
        function showJoinChannels() {
            document.getElementById('loading-screen').style.display = 'none';
            document.getElementById('join-channels-page').classList.add('active');
        }
        
        // Show welcome back message
        function showWelcomeBack() {
            document.getElementById('loading-screen').style.display = 'none';
            document.getElementById('welcome-back-message').style.display = 'flex';
            
            setTimeout(() => {
                document.getElementById('welcome-back-message').style.display = 'none';
                showPage('main-menu-page');
            }, 2000);
        }
        
        // Update join buttons based on joined status
        function updateJoinButtons() {
            const allJoined = Object.keys(joinedChannels).length === channels.length;
            
            if (allJoined) {
                document.getElementById('join-channel-1').textContent = 'Joined';
                document.getElementById('join-channel-1').disabled = true;
                document.getElementById('join-channel-2').textContent = 'Joined';
                document.getElementById('join-channel-2').disabled = true;
            }
        }
        
        // Verify if user joined all channels
        function verifyChannelsJoin() {
            const allJoined = Object.keys(joinedChannels).length === channels.length;
            
            if (!allJoined) {
                document.getElementById('join-error').style.display = 'block';
                return;
            }
            
            document.getElementById('join-error').style.display = 'none';
            
            // Show success message
            const joinPage = document.getElementById('join-channels-page');
            joinPage.innerHTML = `
                <div class="centered" style="height: 70vh;">
                    <h2>Thanks for joining users, earn big</h2>
                </div>
            `;
            
            // Save joined status and proceed to main menu
            localStorage.setItem('adhive_joined', 'true');
            
            setTimeout(() => {
                showPage('main-menu-page');
            }, 3000);
        }
        
        // Show specific page
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            document.getElementById(pageId).classList.add('active');
        }
        
        // Load leaderboard data
        function loadLeaderboard() {
            // Simulate API call
            setTimeout(() => {
                document.getElementById('leaderboard-loading').style.display = 'none';
                
                const leaderboardContent = document.getElementById('leaderboard-content');
                leaderboardContent.style.display = 'block';
                
                // Sample leaderboard data
                const leaderboardData = [
                    { rank: 1, name: "Hi", friends: 2564, points: 147106 },
                    { rank: 2, name: "Alice", friends: 1987, points: 125432 },
                    { rank: 3, name: "Bob", friends: 1765, points: 112345 },
                    { rank: 4, name: "Charlie", friends: 1543, points: 98765 },
                    { rank: 5, name: "Diana", friends: 1321, points: 87654 },
                    { rank: 6, name: "Evan", friends: 1234, points: 76543 },
                    { rank: 7, name: "Fiona", friends: 1111, points: 65432 },
                    { rank: 8, name: "George", friends: 987, points: 54321 },
                    { rank: 9, name: "Hannah", friends: 876, points: 43210 },
                    { rank: 10, name: "Ian", friends: 765, points: 32109 }
                ];
                
                // Clear previous content
                leaderboardContent.innerHTML = '';
                
                // Add leaderboard items
                leaderboardData.forEach(user => {
                    const rankClass = user.rank <= 3 ? `rank-${user.rank}` : 'rank-other';
                    
                    const item = document.createElement('div');
                    item.className = 'leaderboard-item';
                    item.innerHTML = `
                        <div class="rank-circle ${rankClass}">${user.rank}</div>
                        <div class="user-details">
                            <div style="font-weight: 500;">${user.name}</div>
                            <div style="font-size: 14px; color: #666;">${user.friends} friends invited</div>
                        </div>
                        <div class="points">${user.points}</div>
                    `;
                    
                    leaderboardContent.appendChild(item);
                });
            }, 1500);
        }
        
        // Calculate withdrawal amount
        function calculateWithdrawal() {
            const points = parseInt(document.getElementById('withdraw-amount').value) || 0;
            const amount = (points / conversionRate).toFixed(2);
            document.getElementById('received-amount').textContent = `${amount} ${currency}`;
        }
        
        // Copy invite code
        function copyInviteCode() {
            const inviteCode = document.getElementById('invite-code');
            inviteCode.select();
            document.execCommand('copy');
            
            // Show confirmation (you could implement a toast notification here)
            alert('Invite code copied to clipboard!');
        }
        
        // Admin functions
        function updateConversionRate() {
            const newRate = parseInt(document.getElementById('conversion-rate-input').value);
            const newCurrency = document.getElementById('currency-select').value;
            
            if (newRate > 0) {
                conversionRate = newRate;
                currency = newCurrency;
                
                // Update display
                document.getElementById('conversion-rate').textContent = `Conversion rate: 1 point = ${conversionRate} ${currency}`;
                
                alert('Conversion rate updated successfully!');
            } else {
                alert('Please enter a valid conversion rate');
            }
        }
        
        function updateMinWithdrawal() {
            const newMin = parseInt(document.getElementById('min-withdrawal').value);
            
            if (newMin > 0) {
                minWithdrawal = newMin;
                alert('Minimum withdrawal updated successfully!');
            } else {
                alert('Please enter a valid minimum withdrawal amount');
            }
        }
        
        function showMiniAppCode() {
            // In a real implementation, this would fetch the code from the server
            alert('Mini App Code:\n\nThis would contain the complete source code of the mini app in a real implementation.');
        }
        
        // Initialize the app when loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
